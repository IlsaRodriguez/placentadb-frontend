<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placenta Database</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
</head>
<body>

<div class="header">
<!-- Header -->
 <h1 id="title">Placenta Database</h1>
<!-- Logo -->

<!-- About and Contact Hyperlinks -->
 <div class="navbar">
     <a href="contact.html" target="_self">Contact</a>
    <a href="about.html" target="_self">About</a>
     <a href="index.html" target="_parent">Home</a>
    
     
 </div> <br>
<hr>
</div> <br> <br>


<!-- Welcome/Intro Box -->
 <div class="welcome">
    <h3 class="subheader">Welcome to the Placenta Database</h3>
    <p> Lorem ipsum dolor, sit amet consectetur adipisicing elit. Cum sed assumenda id iste laborum voluptates, nostrum rem aperiam. Velit praesentium officia corrupti fuga neque repellat fugit consequuntur blanditiis reprehenderit et? </p>
    <p> Lorem ipsum dolor sit amet consectetur adipisicing elit. Quis magni cumque sapiente. Laborum eius sapiente accusantium, distinctio totam ipsum voluptate quasi nemo perferendis consequuntur velit voluptatem enim, expedita libero molestiae!</p>
 </div> <br><br>
 
<!-- Updates Box -->
 <div class="update">
    <h3 class="subheader">Updates <small>12/12/12</small></h3>
    <ul>
        <li><i>Update 1</i>: Aperiam dolorem officia numquam reprehenderit et praesentium eaque, soluta saepe a nostrum nemo porro repudiandae quia.</li>
        <li><i>Update 2</i>: Pariatur odio alias repellendus veniam voluptas.</li>
        <li><i>Update 3</i>: Accusantium totam assumenda minima praesentium dignissimos dolore.</li>
    </ul>
 </div> <br><br>

<!-- Database Search and Preview -->
<div class="dbFrame">
    <h3 class="subheader">Database Search</h3>
    <!-- Filters -->
     <form>
        <div>
        <label for="organism">Organism</label>
        <select id="organism" name="organism">
            <option value="homo sapiens">Homo sapiens</option>
            <option value="mus musculus">Mus musculus</option>
            <option value="macaca mulatta">Macaca mulatta</option>
            <option value="rattus norvegicus">Rattus norvegicus</option>
            <option value="bos taurus">Bos taurus</option>
            <option value="sus scrofa">Sus scrofa</option>
        </select> 
       </div>
       <div>
        <label for="data type">Data Type</label>
        <select id="data type" name="data type">
            <option value="expression microarray">Expression microarray</option>
            <option value="bulk rna sequencing">Bulk RNA Sequencing</option>
            <option value="single cell rna sequencing">Single cell RNA Sequencing</option>
            <option value="spatial transcriptomics">Spatial transcriptomics</option>
            <option value="proteomics">Proteomics</option>
            <option value="whole genome sequencing">Whole genome sequencing </option>
            <option value="whole exome sequencing">Whole exome sequencing</option>
            <option value="methylation array">Methylation array</option>
            <option value="methylation sequencing">Methylation sequencing</option>
            <option value="high throughput sequencing">High throughput sequencing</option>
            <option value="expression profiling by array">Expression profiling by array</option>
            <option value="single nucleus rna sequence">Single nucleus RNA sequence</option>
        </select>
       </div> <br>
       <div>
        <label for="extracted molecule">Extracted Molecule</label> <br>
        <label>DNA</label>
        <input type="checkbox" id="dna" name="dna" value="DNA"> 
        <label>cDNA</label>
        <input type="checkbox" id="cdna" name="cdna" value="cDNA"> <br>
        <label>total RNA</label>
        <input type="checkbox" id="rna" name="rna" value="RNA">
        <label>mRNA</label>
        <input type="checkbox" id="mrna" name="mrna" value="mRNA">
       </div> <br>
       <div>
        <label for="superseries">Superseries?</label>
        <label>Yes</label>
        <input type="radio" id="yes" name="superseries" value="yes">
        <label>No</label>
        <input type="radio" id="no" name="superseries" value="no">
       </div> <br><br>

       <div>
            <input type="reset">
        </div>
        <br>
        <div>
            <input type="submit">
        </div>
        <br>
     </form>

    <!-- Preview -->
    <div id="dbPreview"> 
        <p>Select search criteria and click Submit to search the database</p>
    </div>

</div> <br><br>

<!-- Database Trends -->
 <div class="dbTrends">
    <h3>Database Trends</h3>
    <div id="trends-content">Loading statistics...</div>
 </div> <br><br>

<hr>

 <div class="footer">
    <a href="https://www.nih.gov" target=_blank>
        <img src="/images/NIH_2013_logo_vertical.svg" height= "100" alt="National Institutes of Health logo with hyperlink" title="NIH">
    </a>
 </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const previewDiv = document.getElementById('dbPreview');
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const organism = document.getElementById('organism').value;
            const dataType = document.getElementById('data type').value;
            const superseries = document.querySelector('input[name="superseries"]:checked')?.value || '';
            
            const molecules = [];
            if (document.getElementById('dna').checked) molecules.push('DNA');
            if (document.getElementById('cdna').checked) molecules.push('cDNA');
            if (document.getElementById('rna').checked) molecules.push('total RNA');
            if (document.getElementById('mrna').checked) molecules.push('mRNA');
            
            const params = new URLSearchParams({
                organism: organism,
                data_type: dataType,
                superseries: superseries
            });
            
            if (molecules.length > 0) {
                params.append('molecule', molecules.join(','));
            }
            
            try {
                previewDiv.innerHTML = '<p>Searching...</p>';
                const response = await fetch(`/api/studies?${params}`);
                const studies = await response.json();
                
                if (studies.length === 0) {
                    previewDiv.innerHTML = '<p>No studies found matching your criteria.</p>';
                } else {
                    let html = `<div style="text-align: left; overflow-y: auto; max-height: 280px;">`;
                    html += `<p><strong>Found ${studies.length} studies:</strong></p>`;
                    studies.forEach(study => {
                        html += `
                            <div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 5px;">
                                <strong>${study.geo_accession}</strong>: ${study.title}<br>
                                <small><em>${study.organism} | ${study.data_type}</em></small><br>
                                <small>${study.summary}</small>
                            </div>
                        `;
                    });
                    html += '</div>';
                    previewDiv.innerHTML = html;
                }
            } catch (error) {
                previewDiv.innerHTML = '<p>Error loading data. Please try again.</p>';
                console.error('Error:', error);
            }
        });
        
        loadStats();
    });
    
    async function loadStats() {
        try {
            const response = await fetch('/api/stats');
            const stats = await response.json();
            
            let html = `<p><strong>Total Studies:</strong> ${stats.total_studies}</p>`;
            html += '<p><strong>By Organism:</strong></p><ul>';
            stats.by_organism.forEach(item => {
                html += `<li>${item.organism}: ${item.count}</li>`;
            });
            html += '</ul>';
            
            html += '<p><strong>By Data Type:</strong></p><ul>';
            stats.by_data_type.forEach(item => {
                html += `<li>${item.data_type}: ${item.count}</li>`;
            });
            html += '</ul>';
            
            document.getElementById('trends-content').innerHTML = html;
        } catch (error) {
            document.getElementById('trends-content').innerHTML = '<p>Error loading statistics.</p>';
            console.error('Error:', error);
        }
    }
</script>
    
</body>
</html>